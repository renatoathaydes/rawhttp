<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#39424E">
    <link rel="shortcut icon" href="/rawhttp/sam.ico" id="favicon">
    <title>RawHTTP</title>
    <link rel="stylesheet" href="/rawhttp/css/styles.css">
</head>
<body>
<div class="main-body"><nav class="main-nav">
    <a href="/rawhttp/index.html">Home</a>
    <a href="/rawhttp/docs/index.html">Docs</a>
    <a href="/rawhttp/rawhttp-modules/cli.html">CLI</a>
    <a href="/rawhttp/rawhttp-modules/duplex.html">Duplex</a>
    <a href="/rawhttp/rawhttp-modules/cookies.html">Cookies</a>
    <a href="/rawhttp/rawhttp-modules/req-in-edit.html">ReqInEdit</a>
</nav><h1>RawHTTP ReqInEdit</h1>

<p>The <code>rawhttp-req-in-edit</code> module implements a runner for HTTP files written in the <a href="https://github.com/JetBrains/http-request-in-editor-spec">Request In Editor Specification</a>
format created by JetBrains to make it easier to execute HTTP requests and test their responses.</p>

<p>HTTP requests are written in a way that&rsquo;s very close to the <a href="https://tools.ietf.org/html/rfc7230#section-3">HTTP RFC-7230</a>,
but <em>with several extensions intended for easier requests composing and editing</em>.</p>

<p>ReqInEdit supports variables, comments, multiple requests in a single file, environments,
and response handlers which may assert the contents of HTTP responses and set variables for usage in the next
requests.</p>

<p>It is perfect for testing HTTP endpoints.</p>

<p>See the <a href="https://www.jetbrains.com/help/idea/http-client-in-product-code-editor.html">IntelliJ Documentation</a> for
the full syntax and examples of writing HTTP files.</p>

<blockquote>
<p>The RawHTTP implementation stays as close as possible to the Jetbrains&rsquo; specification, but minor variations are unavoidable.
  Please report any differences you may come across.</p>
</blockquote>

<h2>Executing HTTP files from the command line</h2>

<p>If all you want is to execute HTTP files from the command line or bash scripts, use the
<a href="cli.html">RawHTTP CLI</a>, which uses <code>rawhttp-req-in-edit</code> to execute HTTP files.</p>

<p>The rest of this document regards the usage of <code>rawhttp-req-in-edit</code> as a Java library, not as a CLI tool.</p>

<h2>Basic Usage</h2>

<p>To execute a HTTP file, parse the file with the <code>com.athaydes.rawhttp.reqinedit.ReqInEditParser</code> class,
then execute it with <code>com.athaydes.rawhttp.reqinedit.ReqInEditUnit</code>:</p>
<pre style="color:#93a1a1;background-color:#002b36">var parser <span style="color:#719e07">=</span> <span style="color:#719e07">new</span> ReqInEditParser<span style="color:#719e07">(</span><span style="color:#719e07">)</span><span style="color:#719e07">;</span>

<span style="color:#719e07">try</span> <span style="color:#719e07">{</span>
    var entries <span style="color:#719e07">=</span> parser<span style="color:#719e07">.</span>parse<span style="color:#719e07">(</span><span style="color:#719e07">new</span> File<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;my.http&#34;</span><span style="color:#719e07">)</span><span style="color:#719e07">)</span><span style="color:#719e07">;</span>
    var allSuccess <span style="color:#719e07">=</span> <span style="color:#719e07">new</span> ReqInEditUnit<span style="color:#719e07">(</span><span style="color:#719e07">)</span><span style="color:#719e07">.</span>run<span style="color:#719e07">(</span>entries<span style="color:#719e07">)</span><span style="color:#719e07">;</span>
    <span style="color:#719e07">if</span> <span style="color:#719e07">(</span>allSuccess<span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
        System<span style="color:#719e07">.</span>out<span style="color:#719e07">.</span>println<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;All tests passed&#34;</span><span style="color:#719e07">)</span><span style="color:#719e07">;</span>
    <span style="color:#719e07">}</span> <span style="color:#719e07">else</span> <span style="color:#719e07">{</span>
        System<span style="color:#719e07">.</span>out<span style="color:#719e07">.</span>println<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;There were test failures&#34;</span><span style="color:#719e07">)</span><span style="color:#719e07">;</span>
    <span style="color:#719e07">}</span>
<span style="color:#719e07">}</span> <span style="color:#719e07">catch</span> <span style="color:#719e07">(</span>IOException e<span style="color:#719e07">)</span> <span style="color:#719e07">{</span>
    <span style="color:#586e75">// handle error
</span><span style="color:#586e75"></span><span style="color:#719e07">}</span>
</pre>
<h2>Customizing ReqInEditUnit</h2>

<p>The <code>ReqInEditUnit</code> class, used to run the parsed entries from a HTTP file as shown above, can be highly customized
to modify all behaviour, including the environment, HTTP parser, HTTP client, file reader, response storage and test reporter.</p>

<p>Here&rsquo;s the full list of parameters in the main constructor:</p>
<pre style="color:#93a1a1;background-color:#002b36">ReqInEditUnit<span style="color:#719e07">(</span>HttpEnvironment<span style="color:#719e07">,</span>
              RawHttp<span style="color:#719e07">,</span>
              RawHttpClient<span style="color:#719e07">,</span>
              FileReader<span style="color:#719e07">,</span>
              ResponseStorage<span style="color:#719e07">,</span> 
              HttpTestsReporter<span style="color:#719e07">)</span>
</pre>
<p>The default <code>HttpEnvironment</code>, <code>com.athaydes.rawhttp.reqinedit.js.JsEnvironment</code>, uses <a href="https://winterbe.com/posts/2014/04/05/java8-nashorn-tutorial/">Nashorn</a>
to interpret response handlers, and it parses variables using the
JavaScript&rsquo;s <a href="https://mustache.github.io/">Mustache library</a> (obtained in Java via <a href="https://www.webjars.org/">webjars</a>).</p>

<p>Notice that the <code>JsEnvironment</code> can be created with a constructor pointing to the HTTP project&rsquo;s root dir and with
an environment name, so that one can use <a href="https://www.jetbrains.com/help/idea/http-client-in-product-code-editor.html#environment-variables">environments</a>.</p>

<p>The default implementation of <code>ResponseStorage</code> writes any response files found in a HTTP file to an actual file
in the working directory.</p>

<p>The following example, when run, will save the HTTP response in the file called <code>response.json</code> in the working directory:</p>
<pre style="color:#93a1a1;background-color:#002b36">### GET request <span style="color:#268bd2">with</span> parameter
GET https<span style="color:#719e07">:</span><span style="color:#586e75">//httpbin.org/get?show_env=1
</span><span style="color:#586e75"></span>Accept<span style="color:#719e07">:</span> application<span style="color:#719e07">/</span>json

<span style="color:#719e07">&gt;</span> {<span style="color:#719e07">%</span>
client.test(<span style="color:#2aa198">&#34;Request executed successfully&#34;</span>, <span style="color:#268bd2">function</span>() {
  client.assert(response.status <span style="color:#719e07">===</span> <span style="color:#2aa198">200</span>, <span style="color:#2aa198">&#34;Response status is not 200&#34;</span>);
});
<span style="color:#719e07">%</span>}
<span style="color:#719e07">&lt;</span><span style="color:#719e07">&gt;</span> response.json
</pre>
<h2>Supported Java versions</h2>

<p>RawHTTP modules are still compiled on <strong>Java 8</strong> in order to support older code bases, but it&rsquo;s tested also on
<strong>Java 11</strong> and <strong>Java 17</strong>.</p>

<p>When running on Java 17, this module only works since version <code>0.3.0</code> due to the removal of Nashorn from the JDK.
Since that version, <code>rawhttp-req-in-edit</code> is published as a <a href="https://openjdk.java.net/jeps/238">multi-release jar</a>,
which means that:</p>

<ul>
<li>when running on <strong>Java 8</strong>, the JDK-native Nashorn script engine is used</li>
<li>when running on <strong>Java 17+</strong>, Nashorn is expected to be present in the classpath as a library, on a different
package (<code>org.openjdk.nashorn</code> instead of the old <code>jdk.nashorn</code>).</li>
</ul>

<p>See the <a href="https://github.com/openjdk/nashorn">openjdk/nashorn</a> repository for details about using Nashorn as a library.
In short, it should work exactly the same as on previous Java versions.</p>
</div>
<footer class="footer">
    <div>
        <small>
            RawHTTP is a project by <a href="https://github.com/renatoathaydes">Renato Athaydes</a>
        </small>
    </div>
    <div>
        <small>Sources on <a href="https://github.com/renatoathaydes/rawhttp">GitHub</a></small>
    </div>
</footer>
</body>
</html>