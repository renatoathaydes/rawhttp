<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#39424E">
    <link rel="shortcut icon" href="/rawhttp/sam.ico" id="favicon">
    <title>RawHTTP</title>
    <link rel="stylesheet" href="/rawhttp/css/styles.css">
</head>
<body>
<div class="main-body"><nav class="main-nav">
    <a href="/rawhttp/index.html">Home</a>
    <a href="/rawhttp/docs/index.html">Docs</a>
    <a href="/rawhttp/rawhttp-modules/cli.html">CLI</a>
    <a href="/rawhttp/rawhttp-modules/duplex.html">Duplex</a>
    <a href="/rawhttp/rawhttp-modules/cookies.html">Cookies</a>
    <a href="/rawhttp/rawhttp-modules/req-in-edit.html">ReqInEdit</a>
</nav><h1>RawHTTP Cookies</h1>

<p>The <code>rawhttp-cookies</code> module provides functionality for HTTP clients and servers to handle cookies.</p>

<p>It also provides a <code>rawhttp.cookies.persist.FileCookieJar</code> class which implements <code>java.net.CookieStore</code>
for easily persisting cookies.</p>

<h2>HTTP client usage</h2>

<p>Instances of <code>rawhttp.core.client.TcpRawHttpClient</code> can support cookies by using this module&rsquo;s
<code>rawhttp.cookies.ClientOptionsWithCookies</code> class, which was designed to <em>wrap</em> another implementation of
<code>TcpRawHttpClient.TcpRawHttpClientOptions</code> (i.e. it uses composition instead of inheritance to add behaviour).</p>

<p>Basic usage:</p>
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;"><code><span style="display:flex;"><span>var client <span style="color:#719e07">=</span> <span style="color:#719e07">new</span> TcpRawHttpClient<span style="color:#719e07">(</span><span style="color:#719e07">new</span> ClientOptionsWithCookies<span style="color:#719e07">(</span><span style="color:#719e07">)</span><span style="color:#719e07">,</span> HTTP<span style="color:#719e07">)</span><span style="color:#719e07">;</span>
</span></span></code></pre>
<p>If you already have a custom implementation of <code>TcpRawHttpClient.TcpRawHttpClientOptions</code>, you can <em>wrap</em> it:</p>
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;"><code><span style="display:flex;"><span>TcpRawHttpClientOptions customClientOptions <span style="color:#719e07">=</span> <span style="color:#719e07">new</span> MyCustomClientOptions<span style="color:#719e07">(</span><span style="color:#719e07">)</span><span style="color:#719e07">;</span>
</span></span><span style="display:flex;"><span>var client <span style="color:#719e07">=</span> <span style="color:#719e07">new</span> TcpRawHttpClient<span style="color:#719e07">(</span><span style="color:#719e07">new</span> ClientOptionsWithCookies<span style="color:#719e07">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#719e07">new</span> CookieManager<span style="color:#719e07">(</span><span style="color:#719e07">)</span><span style="color:#719e07">,</span> <span style="color:#586e75">// java.net.CookieManager
</span></span></span><span style="display:flex;"><span><span style="color:#586e75"></span>    customClientOptions<span style="color:#719e07">)</span><span style="color:#719e07">,</span>
</span></span><span style="display:flex;"><span>    HTTP<span style="color:#719e07">)</span><span style="color:#719e07">;</span>
</span></span></code></pre>
<p>If you want the client to have persistent cookies, pass a <code>FileCookieJar</code> into the constructor:</p>
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;"><code><span style="display:flex;"><span>var cookieJar = new FileCookieJar(new File(&#34;cookies&#34;));
</span></span><span style="display:flex;"><span>var client = new TcpRawHttpClient(
</span></span><span style="display:flex;"><span>    new ClientOptionsWithCookies(cookieJar),
</span></span><span style="display:flex;"><span>    HTTP);
</span></span></code></pre>
<h2>HTTP server usage</h2>

<p>HTTP Servers can use the <code>rawhttp.cookies.ServerCookieHelper</code> class to handle cookies.</p>

<p>Basic usage:</p>

<p><em>Setting a cookie</em></p>
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;"><code><span style="display:flex;"><span>var headers <span style="color:#719e07">=</span> RawHttpHeaders<span style="color:#719e07">.</span>newBuilder<span style="color:#719e07">(</span><span style="color:#719e07">)</span><span style="color:#719e07">;</span>
</span></span><span style="display:flex;"><span>var cookie <span style="color:#719e07">=</span> <span style="color:#719e07">new</span> HttpCookie<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;sid&#34;</span><span style="color:#719e07">,</span> <span style="color:#2aa198">&#34;123456&#34;</span><span style="color:#719e07">)</span><span style="color:#719e07">;</span>
</span></span><span style="display:flex;"><span>ServerCookieHelper<span style="color:#719e07">.</span>setCookie<span style="color:#719e07">(</span>headers<span style="color:#719e07">,</span> cookie<span style="color:#719e07">)</span><span style="color:#719e07">;</span>
</span></span><span style="display:flex;"><span>var response <span style="color:#719e07">=</span> <span style="color:#719e07">new</span> RawHttp<span style="color:#719e07">(</span><span style="color:#719e07">)</span><span style="color:#719e07">.</span>parseResponse<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;200 OK&#34;</span><span style="color:#719e07">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#719e07">.</span>withHeaders<span style="color:#719e07">(</span>headers<span style="color:#719e07">.</span>build<span style="color:#719e07">(</span><span style="color:#719e07">)</span><span style="color:#719e07">)</span><span style="color:#719e07">;</span>
</span></span><span style="display:flex;"><span><span style="color:#586e75">// send response to client
</span></span></span></code></pre>
<p><em>Reading the cookies sent by the client</em></p>
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;"><code><span style="display:flex;"><span>val cookies <span style="color:#719e07">=</span> ServerCookieHelper<span style="color:#719e07">.</span>readClientCookies<span style="color:#719e07">(</span>request<span style="color:#719e07">)</span><span style="color:#719e07">;</span>
</span></span></code></pre>
<p>Because Java cookies do not support the increasingly common <code>SameSite</code> header, all the methods to set cookies
support a separate parameter with a type of <code>rawhttp.cookies.SameSite</code>:</p>
<pre tabindex="0" style="color:#93a1a1;background-color:#002b36;"><code><span style="display:flex;"><span>var headers <span style="color:#719e07">=</span> RawHttpHeaders<span style="color:#719e07">.</span>newBuilder<span style="color:#719e07">(</span><span style="color:#719e07">)</span><span style="color:#719e07">;</span>
</span></span><span style="display:flex;"><span>var cookie <span style="color:#719e07">=</span> <span style="color:#719e07">new</span> HttpCookie<span style="color:#719e07">(</span><span style="color:#2aa198">&#34;sid&#34;</span><span style="color:#719e07">,</span> <span style="color:#2aa198">&#34;123456&#34;</span><span style="color:#719e07">)</span><span style="color:#719e07">;</span>
</span></span><span style="display:flex;"><span>ServerCookieHelper<span style="color:#719e07">.</span>setCookie<span style="color:#719e07">(</span>headers<span style="color:#719e07">,</span> cookie<span style="color:#719e07">,</span> SameSite<span style="color:#719e07">.</span>STRICT<span style="color:#719e07">)</span><span style="color:#719e07">;</span>
</span></span></code></pre>
<h2>Persistent cookie jar</h2>

<p>The <code>rawhttp.cookies.persist.FileCookieJar</code> class, as mentioned above, can be used to persist cookies in a file.</p>

<p>It supports different strategies for <em>flushing</em> cookies added to the jar. These strategies are:</p>

<h4><code>rawhttp.cookies.persist.JvmShutdownFlushStrategy</code></h4>

<p>Only ever flush the cookies when the JVM shutdown. This is the fastest option at runtime because it behaves as an
in-memory cookie jar until the JVM is shut down.</p>

<p>The downside is that it may lose all cookies if the JVM crashes and does not shut down cleanly.</p>

<h4><code>rawhttp.cookies.persist.OnWriteFlushStrategy</code></h4>

<p>A flush strategy that will flush every <code>n</code> updates, where <code>n &gt;= 1</code>.</p>

<p>For example, if <code>n</code> is set to 10, this strategy will only write to the cookie jar&rsquo;s file after 10 cookies are set
or modified.</p>

<p>This strategy also flushes when the JVM shuts down to avoid losing cookies where possible.</p>

<h4><code>rawhttp.cookies.persist.PeriodicFlushStrategy</code></h4>

<p>The periodic flush strategy flushes the cookies to disc periodically. The duration of time between flushes
can be chosen by passing a <code>java.time.Duration</code> instance into its constructor (must be greater than 1 second).</p>

<p>Flushes are performed on a background, daemon Thread. A custom <code>ScheduledExecutorService</code> may be provided in the
constructor to be used for scheduling flushes.</p>

<p>This strategy also flushes when the JVM shuts down to avoid losing cookies where possible.</p>
</div>
<footer class="footer">
    <div>
        <small>
            RawHTTP is a project by <a href="https://github.com/renatoathaydes">Renato Athaydes</a>
        </small>
    </div>
    <div>
        <small>Sources on <a href="https://github.com/renatoathaydes/rawhttp">GitHub</a></small>
    </div>
</footer>
</body>
</html>